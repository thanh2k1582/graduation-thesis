
<div class='shadow w-100 p-container pb-1'>
    <div class='flex-align-center'>
    <div class="input-group w-50 relative">
      <input type="search" class="form-control rounded"  placeholder="Tìm kiếm" aria-label="Search" aria-describedby="search-addon" id="search-box" onkeyup="sendData(this)" onfocusout="offSection(this)"/>
      <section id="searchResults" style="position: absolute; top:110% " class="shadow w-100 bg-c-w t-align-left section-hidden">
      </section>
    </div>
  </div>

<div id="container" class="mt-50">
  {{#each sortedActivities}}
    {{#if this.creator_id}}
    {{!--  --}}
      <div class="container shadow p-2 mb-5 bg-body rounded mb-0 p-tb-0 mt-4 t-align-left">
        <div class="card-body card-body  pl-4 w-100 p-0">
          <div class="d-flex justify-content-between w-100">
            <div class="d-flex flex-row align-items-center w-100">
              <a href="/post/detail?id={{this.id}}">
                  <div style="background-image: url('/images/{{this.imageShow}}')" class="bg-i-inn">
                  </div>
              </a>
              <div class="ms-3 flex-1">
                <div class="flex">
                  <a href="/post/detail?id={{this.id}}" class="a flex-1">
                    <h5>{{this.title}}</h5>
                  </a>
                  <ul class="navbar-nav me-auto mb-2 mb-lg-0 align-middle flex-end">
                    <li class="nav-item dropdown">
                      
                      <a class="nav-link p-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class='material-icons t-c-b z-index-100 cursor' style='font-size:24px' aria-hidden='true'> more_vert</i>
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                          <li><a class="dropdown-item" href='/post/detail?id={{this.id}}'>Xem chi tiết</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="flex">
                  <p class="small mb-0">Giá thuê: {{this.price}} triệu/tháng</p>
                  <p class="small mb-0 ml-20px">Diện tích phòng: {{this.acreage}} m2</p>
                  <p class="small mb-0 ml-20px">Địa chỉ: {{this.address}}</p>
                </div>
                <p>{{this.description}}</p>
                <div class="pl-0 flex">
                  <div class="flex-align-center w-100">
                      <a class="nav-link dropdown-toggle pl-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <img src="{{this.avatar_link}}" width="40" height="40" class="rounded-circle">
                      </a>
                      <p class="mb-0">{{this.name}}</p>
                      {{!--  --}}
                      <div class="flex flex-1 flex-end">
                      </div>
                      {{!--  --}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {{!--  --}}
    {{else}}
    <div class='shadow bg-body rounded mb-4 p-tb-0 w-100 mt-4'>
      <div class='card-body p-2 pl-4'>
        <div class='d-flex justify-content-between w-100'>
          <div class='d-flex flex-row align-items-center t-align-left w-100'>
            <a href='/inns/{{this.id}}?title={{this.title}}'>
              <div
                style="
            background-image: url('{{this.image_slide}}');"
                class='bg-i-inn'
              >
              </div>
            </a>
            <div class='ms-3 w-100'>
              <div class='flex'>
                <a href='/inns/{{this.id}}?title={{this.title}}' class='a flex-1'>
                  <h6>{{this.title}}</h6>
                </a>
                {{!--  --}}
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 align-middle flex-end">
                  <li class="nav-item dropdown">
                    
                    <a class="nav-link p-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <i
                        class='material-icons t-c-b z-index-100 cursor'
                        style='font-size:24px'
                        aria-hidden='true'
                      >more_vert</i>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href='/inns/{{this.id}}?title={{this.title}}'>Xem chi tiết</a></li>
                    </ul>
                  </li>
                </ul>
                {{!--  --}}
              </div>
              <div class='flex'>
                <p class='small mb-0'>Giá thuê: {{this.price}} triệu/tháng</p>
                <p class='small mb-0 ml-20px'>Diện tích: {{this.acreage}} m2</p>
                <p class='small mb-0 ml-20px'>Địa chỉ: {{this.address}}</p>
              </div>
              <p>{{this.description_short}}</p>
              <div class='pl-0 flex'>
                <a
                  class='nav-link dropdown-toggle pl-0'
                  href='#'
                  id='navbarDropdown'
                  role='button'
                  data-bs-toggle='dropdown'
                  aria-expanded='false'
                >
                  <img src='{{this.avatar}}' width='40' height='40' class='rounded-circle' />
                </a>
                <div class='flex-align-center'>
                  <p class='mb-0'>{{this.author}}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {{/if}}
  {{/each}}
</div>

  {{#if length}}
    <div class='flex-align-center'>
      <nav aria-label='Page navigation example shadow'>
        {{#with pageNum}}
          <ul class='pagination t-c'>
            <li class='page-item'>
              <a class='page-link' href='/all-inns?page={{pre}}' aria-label='Previous'>
                <span aria-hidden='true'>&laquo;</span>
                <span class='sr-only'>Trang sau</span>
              </a>
            </li>
            <li class='page-item'><a class='page-link t-c' href='/all-inns?page={{now}}'>{{now}}</a></li>
            <li class='page-item'><a class='page-link' href='/all-inns?page={{next}}'>{{next}}</a></li>
            <li class='page-item'><a class='page-link' href='/all-inns?page={{next2}}'>{{next2}}</a></li>
            <li class='page-item'>
              <a class='page-link' href='/all-inns?page={{next}}' aria-label='Next'>
                <span aria-hidden='true'>&raquo;</span>
                <span class='sr-only'>Trang sau</span>
              </a>
            </li>
          </ul>
        {{/with}}
      </nav>
    </div>
  {{else}}
    <div class='flex-align-center' id="page">
      <nav aria-label='Page navigation example shadow'>
        <ul class='pagination t-c'>
          <li class='page-item'>
            <a class='page-link disabled a-c' href='#' aria-label='Previous'>
              <span aria-hidden='true'>&laquo;</span>
              <span class='sr-only'>Previous</span>
            </a>
          </li>
          <li class='page-item'><a class='page-link t-c' href='/all-inns?page=1'>1</a></li>
          <li class='page-item'><a class='page-link' href='/all-inns?page=2'>2</a></li>
          <li class='page-item'><a class='page-link' href='/all-inns?page=3'>3</a></li>
          <li class='page-item'>
            <a class='page-link' href='/all-inns?page=2' aria-label='Next'>
              <span aria-hidden='true'>&raquo;</span>
              <span class='sr-only'>Next</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  {{/if}}

</div>

<script>
  async function sendData(e) {
    const searchResults = document.getElementById("searchResults");
    searchResults.classList.remove('section-hidden');
    const fetchData = await fetch('/all-inns/search', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({payload: e.value})
    })
    
    const items = await fetchData.json()
    let options = ''
    if (!items) {
      options = '<option class="option" value="">Không có bài viết nào như bạn cần tìm</option>'
    }
    await items.map(item => {
        options += `<option class="option" value="">${item.title}</option>`
    })
    searchResults.innerHTML = options;
{{!-- container --}}
    const container = document.getElementById('container');

    let insideContainer = '';
    await items.map(item => {
      if(item.creator_id) {
        insideContainer += `<div class="container shadow p-2 mb-5 bg-body rounded mb-0 p-tb-0 mt-4 t-align-left">
        <div class="card-body card-body  pl-4 w-100 p-0">
          <div class="d-flex justify-content-between w-100">
            <div class="d-flex flex-row align-items-center w-100">
              <a href="/post/detail?id=${item.id}">
                  <div style="background-image: url('/images/${item.imageShow}')" class="bg-i-inn">
                  </div>
              </a>
              <div class="ms-3 flex-1">
                <div class="flex">
                  <a href="/post/detail?id=${item.id}" class="a flex-1">
                    <h5>${item.title}</h5>
                  </a>
                  <ul class="navbar-nav me-auto mb-2 mb-lg-0 align-middle flex-end">
                    <li class="nav-item dropdown">
                      
                      <a class="nav-link p-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class='material-icons t-c-b z-index-100 cursor' style='font-size:24px' aria-hidden='true'> more_vert</i>
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                          <li><a class="dropdown-item" href='/post/detail?id=${item.id}'>Xem chi tiết</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="flex">
                  <p class="small mb-0">Giá thuê: ${item.price} triệu/tháng</p>
                  <p class="small mb-0 ml-20px">Diện tích phòng: ${item.acreage} m2</p>
                  <p class="small mb-0 ml-20px">Địa chỉ: ${item.address}</p>
                </div>
                <p>${item.description}</p>
                <div class="pl-0 flex">
                  <div class="flex-align-center w-100">
                      <a class="nav-link dropdown-toggle pl-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <img src="${item.avatar_link}" width="40" height="40" class="rounded-circle">
                      </a>
                      <p class="mb-0">${item.name}</p>
                      <div class="flex flex-1 flex-end">
                      </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>`
      } else {
        insideContainer += `<div class='shadow bg-body rounded mb-4 p-tb-0 w-100 mt-4'>
      <div class='card-body p-2 pl-4'>
        <div class='d-flex justify-content-between w-100'>
          <div class='d-flex flex-row align-items-center t-align-left w-100'>
            <a href='/inns/${item.id}?title=${item.title}'>
              <div
                style="
            background-image: url('${item.image_slide}');"
                class='bg-i-inn'
              >
              </div>
            </a>
            <div class='ms-3 w-100'>
              <div class='flex'>
                <a href='/inns/${item.id}?title=${item.title}' class='a flex-1'>
                  <h6>${item.title}</h6>
                </a>
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 align-middle flex-end">
                  <li class="nav-item dropdown">
                    <a class="nav-link p-0" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class='material-icons t-c-b z-index-100 cursor' style='font-size:24px' aria-hidden='true'
                      >more_vert
                      </i>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li>
                          <a class="dropdown-item" href='/inns/${item.id}?title=${item.title}'>Xem chi tiết</a>
                        </li>
                    </ul>
                  </li>
                </ul>
              </div>
              <div class='flex'>
                <p class='small mb-0'>Giá thuê: ${item.price} triệu/tháng</p>
                <p class='small mb-0 ml-20px'>Diện tích: ${item.acreage} m2</p>
                <p class='small mb-0 ml-20px'>Địa chỉ: ${item.address}</p>
              </div>
              <p>${item.description_short}</p>
              <div class='pl-0 flex'>
                <a
                  class='nav-link dropdown-toggle pl-0'
                  href='#'
                  id='navbarDropdown'
                  role='button'
                  data-bs-toggle='dropdown'
                  aria-expanded='false'
                >
                  <img src='${item.avatar}' width='40' height='40' class='rounded-circle' />
                </a>
                <div class='flex-align-center'>
                  <p class='mb-0'>${item.author}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>`
      }
    });
    if (items.length === 0) {
      insideContainer = '<div class="flex-align-center">Không có kết quả bạn đang muốn tìm kiếm</div>'
    }
    container.innerHTML = insideContainer
    document.getElementById('page').innerHTML = ''
  }

  function offSection(e) {
    const searchResults = document.getElementById("searchResults");
    searchResults.classList.add('section-hidden');
  }
</script>